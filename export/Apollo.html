<html lang="en"><head>
<meta charset="UTF-8">
<title>Apollo cheat sheet</title>
<meta name="viewport" content="width=device-width" />
<meta name="livenode" content="#doc" />
<meta property="og:type" content="article" />
<meta property="og:locale" content="en_us" />
<meta property="og:site_name" content="YellowAfterlife" />
<meta property="og:title" content="Apollo cheat sheet" />
<script type="text/javascript">
if (document.location.host == "yal.cc" && location.protocol == "http:") {
	document.location.protocol = "https:";
}
</script>
<style type="text/css">body, #doc tt, #doc code {
	font: 15px 'Open Sans', sans-serif;
	line-height: 1.35;
}
body {
	margin: 0;
}
.main {
	width: 100%;
	min-height: 100%;
	min-height: 100vh;
	background-color: #f5f7f9;
}
.page {
	max-width: 656px;
	background: #ffffff;
	margin: 0 auto;
	padding: 8px;
	box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
	min-height: 100%;
	min-height: 100vh;
	box-sizing: border-box;
}
.page > p:first-child {
	margin-top: 0;
}
#doc, #doc ul, #doc ol {
	padding-left: 0;
	margin: 0;
}
#doc article > ul, #doc article > ol {
	padding-left: 20px;
}
#doc article ul li {
	list-style: disc;
	list-style-image: url('data:image/svg+xml;base256,<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="20px" height="1em" viewBox="0 0 20px 1em"><circle cx="17px" cy="0.675em" r="2px"/></svg>'); 
}

#doc header {
	margin: 0;
	font-weight: 700;
	font-size: 100%;
	color: #458;
	border-left: 2px solid #f3f3f3;/* #f9f9f9*/
	padding-left: 4px;
	padding-top: 1px;
	padding-bottom: 1px;
	cursor: pointer;
}
#doc header a {
	outline: none;
	text-decoration: none;
	color: #458;
}
#doc header::before {
	display: inline-block;
	content: "+";
	font: 12px monospace;
	border: 1px solid #458;
	line-height: 11px;
	height: 11px;
	width: 11px;
	text-align: center;
	border-radius: 50%;
	margin-right: 4px;
	vertical-align: middle;
	position: relative;
	top: -1px;
}
#doc section.open > header::before {
	content: "-";
}
#doc section.empty > header::before {
	content: " "; /*"·"*/
}
#doc header:hover {
	border-left-color: #f3f3f3;
	background: #f3f3f3;
}
#doc header .ret-arrow {
	font-weight: normal;
	margin: 0 0.1em;
}

#doc a.broken {
	color: red;
}
#doc p, .intro p {
	margin: 0;
}
#doc p + p, .intro p + p, #doc p.pad, .display-controls {
	margin-top: 0.5em;
}
#doc img {
	max-width: 100%;
}
#doc h3 {
	margin: 0.25em 0;
	font-size: 125%;
	font-weight: normal;
	border-bottom: 1px solid #ccc;
}

#doc article, #doc ul {
	padding-left: 20px;
	border-left: 2px solid #f3f3f3;
}
#doc article {
	padding-top: 0.25em;
	padding-bottom: 0.5em;
}
#doc tt {
	font-weight: bold;
}
#doc code {
	display: inline-block;
	background: #FFFBE4;
	font-family: Consolas, Ubuntu Mono, Dejavu Sans Mono, Lucida Console, monospace;
	font-weight: normal;
	font-size: 12px;
	line-height: 16px;
	padding: 0 2px;
	border: 1px solid #E6E0C4;
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
	max-width: 100%;
	word-break: break-word;
}

#doc table {
	border-spacing: 0;
	color: currentColor;
}
#doc table, #doc table td, #doc table th {
	border: 1px solid #f3f3f3;
}
#doc table td, #doc table th {
	padding: 0.1em 0.5em;
}
#doc pre {
	font-family: Consolas, Dejavu Sans Mono, Segoe UI Mono, Ubuntu Mono, Lucida Console, monospace;
	font-size: 9pt;
	line-height: 1.25;
	background: white;
	padding: 4px 2px 4px 10px;
	margin: 0;
	-moz-tab-size: 4;
	tab-size: 4;
	overflow-x: auto;
	white-space: pre-wrap;
	word-break: break-all;
}
#doc pre a {
	text-decoration: none;
}
#doc pre a.uf {
	background-color: #f7f0ff;
}
#doc pre a.kw {
	background-color: #f0f7ff;
}
#doc pre a.sf, #doc pre a.sv {
	background-color: #fff3f0;
}
#doc pre a:hover {
	text-decoration: underline;
}
#doc abbr[title] {
	text-decoration: underline;
	-webkit-text-decoration-color: #bbb;
	text-decoration-color: #bbb;
	-webkit-text-decoration-style: double;
	text-decoration-style: double;
}
#doc hr {
	margin: 0.5em 0;
	margin-right: 1em;
	border: 0;
	border-top: 2px dashed #f3f3f3;
}
#doc section + hr {
	margin: 0;
	height: 1em;
	border: 1px solid #f3f3f3;
	border-width: 1px 0 1px 0;
}
#doc section {
	border-top: 1px solid #f3f3f3;
	margin-top: 0.3em;
}
#doc section:first-child {
	margin-top: 0em;
}
#doc section:last-child {
	border-bottom: 1px solid #f3f3f3;
}
#doc section + section, #doc hr + section {
	border-top: 0;
	margin-top: 0;
}
#doc section + p {
	border-top: 1px solid #f3f3f3;
	padding-top: 0.3em;
}
/* delay display until load */
#doc[ready] section:not(.open) > article {
	display: none;
}</style>
<style type="text/css" id="lang_gml">/* GameMakerLanguage */
pre.gmlmd .md { color: #7A81A9 } /* #define */
pre.gmlmd .kw { color: #008; font-weight: bold } /* keyword */
pre.gmlmd .co { color: #080 } /* comment */
pre.gmlmd .nu { color: #00f } /* number */
pre.gmlmd .nx { color: #00f } /* hex */
pre.gmlmd .st { color: #00f } /* string */
pre.gmlmd .ts { color: #00f } /* template string */
pre.gmlmd .op { color: #000 } /* operator */
pre.gmlmd .cb { color: #008; font-weight: bold } /* curly brace */
pre.gmlmd .sv { color: #800 } /* std func */
pre.gmlmd .sf { color: #800 } /* std var */
pre.gmlmd .ri { color: #0078aa } /* assets */
pre.gmlmd .uf { color: #808 } /* user func */
pre.gmlmd .uv { color: #000 } /* user var */
pre.gmlmd .lv { color: #648 } /* local var */
pre.gmlmd .fd { color: #804 } /* field */

#night:checked + .main pre.gmlmd .op { color: #CCCCCC }
#night:checked + .main pre.gmlmd .co { color: #5B995B }
#night:checked + .main pre.gmlmd .kw { color: #FFB871 }
#night:checked + .main pre.gmlmd .md { color: #FFB871 }
#night:checked + .main pre.gmlmd .cb { color: #FFB871 }
#night:checked + .main pre.gmlmd .sf { color: #FFB871 }
#night:checked + .main pre.gmlmd .uf { color: #FFB871 }
#night:checked + .main pre.gmlmd .nu { color: #FF8080 }
#night:checked + .main pre.gmlmd .st { color: #FCF320 }
#night:checked + .main pre.gmlmd .ts { color: #FF8080 }
#night:checked + .main pre.gmlmd .sv { color: #FF8080 }
#night:checked + .main pre.gmlmd .gv { color: #FF80FF }
#night:checked + .main pre.gmlmd .ri { color: #FF8080 }
#night:checked + .main pre.gmlmd .lv { color: #FFF899 }
#night:checked + .main pre.gmlmd .uv { color: #B2B1FF }
#night:checked + .main pre.gmlmd .fd { color: #B2B1FF }

#night:checked + .main pre.gmlmd a.uf,
#night:checked + .main pre.gmlmd a.kw,
#night:checked + .main pre.gmlmd a.sf {
	background-color: #431;
}
#night:checked + .main pre.gmlmd a.sv {
	background-color: #422;
}</style>
<style type="text/css" id="night_css">.main label[for="night"] {
	cursor: pointer;
}
#night { display: none }
#night:checked + .main {
	background-color: #424242;
}
#night:checked + .main .page {
	background-color: #1c1c1c;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
	color: white;
}
#night:checked + .main a,
#night:checked + .main a:visited,
#night:checked + .main #doc header,
#night:checked + .main label[for="night"] {
	color: #9DEC76;
}
#night:checked + .main #doc header:before,
#night:checked + .main #doc h3 {
	border-color: #9DEC76
}
#night:checked + .main #doc header,
#night:checked + .main #doc header:hover,
#night:checked + .main #doc article,
#night:checked + .main #doc section,
#night:checked + .main #doc section + p,
#night:checked + .main #doc hr,
#night:checked + .main #doc ul,
#night:checked + .main #doc table,
#night:checked + .main #doc table td,
#night:checked + .main #doc table th
{
	border-color: rgba(205,225,255,0.1);
}
#night:checked + .main #doc header:hover,
#night:checked + .main #doc .asset:hover {
	background: rgba(205,225,255,0.1);
}
#night:checked + .main article ul li {
	list-style-image: url('data:image/svg+xml;base256,<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="20px" height="1em" viewBox="0 0 20px 1em"><circle cx="17px" cy="0.675em" r="2px" fill="white"/></svg>'); 
}
#night:checked + .main pre {
	color: #cccccc;
	background: #000000;
	border: 1px solid #3E4757;
}
#night:checked + .main #doc code {
	background-color: #000;
	border-color: #5b7c9f;
	color: white;
}</style>
<style type="text/css" id="print_css">@media print {
	.main { background-color: transparent }
	.display-controls { display: none; }
	.page { width: 100%; box-shadow: none; }
	#doc header::before,
	#doc section.open header::before	{
		content: "~";
	}
	#doc { display: inherit }
	#doc section:not(.open) > article,
	#doc[ready] section:not(.open) > article {
		display: inherit;
	}
}</style>
<noscript><style>#doc header::before {
	content: "~";
}
#doc header:hover {
	border-left-color: #f3f3f3;
	background: inherit;
}
#doc { display: inherit }
#doc section:not(.open) > article {
	display: inherit;
}</style></noscript>
</head><body>
<input type="checkbox" id="night" checked/>
<div class="main ">
<script type="text/javascript">(function() {
	var night = document.getElementById("night");
	var path = "docmd night mode";
	var ls = window.localStorage;
	if (ls) {
		night.checked = ls.getItem(path) == "true";
		night.onchange = function(_) {
			ls.setItem(path, "" + night.checked);
		};
	}
})();</script>
<main class="page">
<section class="intro">This is a "cheat sheet" for the "Apollo" extension (v3) by YellowAfterlife.<br/>
The extension can be found on
<a href="https://yellowafterlife.itch.io/gamemaker-lua">itch.io</a>.</section><section class="display-controls">
Click on sections to expand/collapse them.<br>Quick display controls:
<a href="javascript:void(0)" onclick="opt_none(); return false">Categories</a>
&middot; <a href="javascript:void(0)" onclick="opt_list(); return false">Sections</a>
&middot; <a href="javascript:void(0)" onclick="opt_all(); return false">Everything</a>
&middot; <a href="javascript:void(0)"><label for="night">Toggle night mode</label></a><br/>
</section><section id="doc">
<!--<doc--><p>
<style>
.main {
	background-color: #889EC5;
}
#night:checked + .main {
	background-color: #405070;
}
</style>
<p>





<style>.main { 
	background-repeat: no-repeat;
	background-position: top right;
	background-attachment: fixed;
	background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjE2MCIgaGVpZ2h0PSIxNjAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDE2MCAxNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0icmFkaWFsR3JhZGllbnQ0MjM2IiBjeD0iLTEwNC4yOSIgY3k9IjkxNi45NSIgcj0iNjIuNzU4IiBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDEuMjI2OSAuMDk1NjA1IC0uMDM4NDQ2IC40OTMzOSAzNi4yMTMgNDUzLjkxKSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjZmZmIiBzdG9wLW9wYWNpdHk9IjAiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjZmZmIiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPG1ldGFkYXRhPgogIDxyZGY6UkRGPgogICA8Y2M6V29yayByZGY6YWJvdXQ9IiI+CiAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgIDxkYzp0eXBlIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiLz4KICAgPC9jYzpXb3JrPgogIDwvcmRmOlJERj4KIDwvbWV0YWRhdGE+CiA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIC04NTIuMzYpIiBzaGFwZS1yZW5kZXJpbmc9ImF1dG8iPgogIDxwYXRoIGQ9Im04MCA4ODIuMzZhNTAgNTAgMCAwIDAtNTAgNTAgNTAgNTAgMCAwIDAgNTAgNTAgNTAgNTAgMCAwIDAgNTAtNTAgNTAgNTAgMCAwIDAtNTAtNTB6bTIxIDE0YTE1IDE1IDAgMCAxIDE1IDE1IDE1IDE1IDAgMCAxLTE1IDE1IDE1IDE1IDAgMCAxLTE1LTE1IDE1IDE1IDAgMCAxIDE1LTE1eiIgY29sb3I9IiMwMDAwMDAiIGNvbG9yLXJlbmRlcmluZz0iYXV0byIgZmlsbD0iI2ZmZiIgaW1hZ2UtcmVuZGVyaW5nPSJhdXRvIiBvcGFjaXR5PSIuMzIiIHNvbGlkLWNvbG9yPSIjMDAwMDAwIiBzdHlsZT0iaXNvbGF0aW9uOmF1dG87bWl4LWJsZW5kLW1vZGU6bm9ybWFsIi8+CiAgPGNpcmNsZSBjeD0iMTMwLjUiIGN5PSI4ODEuODYiIHI9IjE0LjUiIGNvbG9yPSIjMDAwMDAwIiBjb2xvci1yZW5kZXJpbmc9ImF1dG8iIGZpbGw9IiNmZmYiIGltYWdlLXJlbmRlcmluZz0iYXV0byIgb3BhY2l0eT0iLjMyIiBzb2xpZC1jb2xvcj0iIzAwMDAwMCIgc3R5bGU9Imlzb2xhdGlvbjphdXRvO21peC1ibGVuZC1tb2RlOm5vcm1hbCIvPgogIDxwYXRoIHRyYW5zZm9ybT0ibWF0cml4KC0xIDAgMCAxIC0yMCAtMTApIiBkPSJtLTEyNi40NiA4OTYuNTNjMjUuMzA5LTE2LjI1NCA1OS42NzktNy42Nzk4IDc1LjY0OCAxNy40MyAxNy4yNTcgMjcuMTM0IDguMDMyNiA2My44Ny0xOC45IDgwLjg2MS0yOC45MTEgMTguMjM5LTY3Ljk1OCA4LjM4MTQtODUuOTQ2LTIwLjMyOC0xMC4xODQtMTYuMjU0LTEyLjU1MS0zNi42MjQtNi42MTY2LTU0LjgzNyIgY29sb3I9IiMwMDAwMDAiIGNvbG9yLXJlbmRlcmluZz0iYXV0byIgZmlsbD0ibm9uZSIgaW1hZ2UtcmVuZGVyaW5nPSJhdXRvIiBvcGFjaXR5PSIuMTI1IiBzb2xpZC1jb2xvcj0iIzAwMDAwMCIgc3Ryb2tlPSJ1cmwoI3JhZGlhbEdyYWRpZW50NDIzNikiIHN0cm9rZS1kYXNoYXJyYXk9IjgsIDgiIHN0cm9rZS1kYXNob2Zmc2V0PSIxIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgc3R5bGU9Imlzb2xhdGlvbjphdXRvO21peC1ibGVuZC1tb2RlOm5vcm1hbCIvPgogIDxwYXRoIGQ9Im0xMzguNTkgODk4LjU0Yy0xLjE0NyAzLjIzMjctMS4wMzg2IDYuOTMxNiAwLjc3MTQ4IDExLjI2bC0xLjIzODMgMy4yNzkzYzIuOTAzNCAxLjAzMzYgMi4wODggMS42Mjc1IDMuMjY1NiAyLjk2ODggMC4wMTQzLTEuNzMxMS0wLjgwOTgxLTMuNTkyOCAxLjQyMTktNC40ODgzIDIuMzMyNi0wLjU4NDE3IDIuNzU4IDEuNDA3NCAzLjc4NTIgMi44MDA4IDAuMTY2NzMtMS43NzcxLTAuODQ0NC0xLjc3OTggMC45MDAzOS00LjMyMDNsLTIuOTI1OC0xLjkyNzdjLTEuMDczNS00LjU2Ny0zLjE1NS03LjYyNzQtNS45ODA1LTkuNTcyM3oiIGNvbG9yPSIjMDAwMDAwIiBjb2xvci1yZW5kZXJpbmc9ImF1dG8iIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iLjMyIiBpbWFnZS1yZW5kZXJpbmc9ImF1dG8iIHNvbGlkLWNvbG9yPSIjMDAwMDAwIiBzdHlsZT0iaXNvbGF0aW9uOmF1dG87bWl4LWJsZW5kLW1vZGU6bm9ybWFsIi8+CiA8L2c+Cjwvc3ZnPgo=);
}</style>

</p><section class="empty"><header id="Concepts"><a href="#Concepts" title="(permalink)">Concepts</a></header><article><section><header id="struct-flat"><a href="#struct-flat" title="(permalink)">Struct API and Flat API</a></header></section></article></section><section><header id="LuaState"><a href="#LuaState" title="(permalink)">Lua states</a></header><article><p>
	Lua states are now represented as structs!
	</p><p>
	To create a Lua state, you do <code>state = new LuaState()</code> and it exists while it's being referenced.
	</p><p>
	It has the following methods:
	</p><section><header id="LuaState-toString"><a href="#LuaState-toString" title="(permalink)">toString()&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
		Returns a short, unique string representation of the state.
		</p><p>
		It'll usually look like this:
		</p><pre>
LuaState(ptr:000000000474BEF0)
</pre></article></section><section><header id="LuaState-adding-code"><a href="#LuaState-adding-code" title="(permalink)">Adding code</a></header><article><p>
		Adding code:
		</p><section><header id="LuaState-addCode"><a href="#LuaState-addCode" title="(permalink)">addCode(code)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Compiles and executes a snippet of Lua code (see <a href="https://www.lua.org/manual/5.4/manual.html#luaL_dostring">luaL_dostring</a>).
			</p><p>
			If the code uses <code>return</code> statement, returns the first value.
			</p><p>
			For example, doing
			</p><pre class="gmlmd">
<span class="kw">var</span> <span class="lv">state</span> <span class="op">=</span> <span class="kw">new</span> <a class="sf" href="#LuaState">LuaState</a><span class="op">(</span><span class="op">)</span><span class="op">;</span>
<span class="lv">state</span><span class="op">.</span><span class="sf">addCode</span><span class="op">(</span><span class="st">@'
    print("Hello world!");
'</span><span class="op">)</span><span class="op">;</span>
</pre><p>
			would print "Hello world!" into GameMaker's Output panel.
		</p></article></section><section><header id="LuaState-addCodeMultRet"><a href="#LuaState-addCodeMultRet" title="(permalink)">addCodeMultRet(code)&#8203;<span class="ret-arrow">&#10140;</span>array</a></header><article><p>
			Like <code>addCode</code>, but packs multiple returned values into an array (see <a href="https://www.lua.org/manual/5.4/manual.html#3.3.4">§3.3.4</a>).
		</p></article></section></article></section><section><header id="LuaState-globals"><a href="#LuaState-globals" title="(permalink)">Global variables</a></header><article><p>
		Working with globals:
		</p><section><header id="LuaState-get"><a href="#LuaState-get" title="(permalink)">get(name)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Retrieves a global variable by a name.
			</p><p>
			For tables and other reference types, this returns a <a href="#LuaRef">LuaRef</a>,
			which allows further chaining to retrieve nested values:
			</p><pre class="gmlmd">
<span class="kw">var</span> <span class="lv">state</span> <span class="op">=</span> <span class="kw">new</span> <a class="sf" href="#LuaState">LuaState</a><span class="op">(</span><span class="op">)</span><span class="op">;</span>
<span class="sf">show_debug_message</span><span class="op">(</span><span class="lv">state</span><span class="op">.</span><span class="sf">get</span><span class="op">(</span><span class="st">"math"</span><span class="op">)</span><span class="op">.</span><span class="sf">get</span><span class="op">(</span><span class="st">"pi"</span><span class="op">)</span><span class="op">)</span><span class="op">;</span> <span class="co">// 3.14</span>
<span class="sf">show_debug_message</span><span class="op">(</span><span class="lv">state</span><span class="op">.</span><span class="sf">get</span><span class="op">(</span><span class="st">"string"</span><span class="op">)</span><span class="op">.</span><span class="sf">get</span><span class="op">(</span><span class="st">"reverse"</span><span class="op">)</span><span class="op">.</span><span class="sf">call</span><span class="op">(</span><span class="st">"123"</span><span class="op">)</span><span class="op">)</span><span class="op">;</span> <span class="co">// 321</span>
</pre><p>
			<b>C function:</b> <a href="https://www.lua.org/manual/5.4/manual.html#lua_getglobal"><code>lua_getglobal</code></a><br/>
			<b>Flat function:</b> <code>lua_global_get</code>
		</p></article></section><section><header id="LuaState-set"><a href="#LuaState-set" title="(permalink)">set(name, value)</a></header><article><p>
			Changes a value of a global variable.
			</p><p>
			For example,
			</p><pre class="gmlmd">
<span class="kw">var</span> <span class="lv">state</span> <span class="op">=</span> <span class="kw">new</span> <a class="sf" href="#LuaState">LuaState</a><span class="op">(</span><span class="op">)</span><span class="op">;</span>
<span class="lv">state</span><span class="op">.</span><span class="sf">set</span><span class="op">(</span><span class="st">"game_version"</span><span class="op">,</span> <span class="st">"1.0.0"</span><span class="op">)</span><span class="op">;</span>
<span class="lv">state</span><span class="op">.</span><span class="sf">addCode</span><span class="op">(</span><span class="st">@'
    print(game_version) -- "1.0.0"
'</span><span class="op">)</span><span class="op">;</span>
</pre><p>
			If you need to change a value inside an object, you'll want to set() on a LuaRef instead:
			</p><pre class="gmlmd">
<span class="kw">var</span> <span class="lv">state</span> <span class="op">=</span> <span class="kw">new</span> <a class="sf" href="#LuaState">LuaState</a><span class="op">(</span><span class="op">)</span><span class="op">;</span>
<span class="lv">state</span><span class="op">.</span><span class="sf">get</span><span class="op">(</span><span class="st">"math"</span><span class="op">)</span><span class="op">.</span><span class="sf">set</span><span class="op">(</span><span class="st">"tau"</span><span class="op">,</span> <span class="sv">pi</span> <span class="op">*</span> <span class="nu">2</span><span class="op">)</span>
<span class="lv">state</span><span class="op">.</span><span class="sf">addCode</span><span class="op">(</span><span class="st">@'
    print(math.tau) -- 6.2831853071796
'</span><span class="op">)</span><span class="op">;</span>
</pre><p>
			<b>Flat function:</b> <code>lua_global_set</code>
		</p></article></section><section><header id="LuaState-call"><a href="#LuaState-call" title="(permalink)">call(name, ...args)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			<b>Flat function:</b> <code>lua_global_call</code>
		</p></article></section><section><header id="LuaState-callExt"><a href="#LuaState-callExt" title="(permalink)">callExt(name, argArray)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			<b>Flat function:</b> <code>lua_global_call_ext</code>
		</p></article></section></article></section></article></section><section><header id="lua-gml"><a href="#lua-gml" title="(permalink)">GML↔Lua conversions</a></header><article><section><header>Conversion rules</header><article><p>
		Passing types between GML and Lua converts them as following:
		</p><ul>
		<li>	<code>undefined</code> ↔ <code>nil</code>
		</li><li>	<code>real</code> ↔ <code>number</code> (floating-point, 64-bit)
		</li><li>	<code>int64</code> ↔ <code>number</code> (integer, 64-bit)
		</li><li>	<code>int32</code> → <code>number</code> (integer, 64-bit)
		</li><li>	<code>string</code> ↔ <code>string</code>
		</li><li>	<code>LuaTable</code> ← <code>table</code>
		</li><li>	<code>LuaFunction</code> ← <code>function</code>
		</li><li>	<code>LuaUserdata</code> ← <code>userdata</code>
		</li><li>	<code>LuaRef</code> ← <code>lightuserdata</code>
		</li><li>	<code>array</code> → <code>GmlArray</code>
		</li><li>	<code>struct</code> → <code>GmlStruct</code>
		</li><li>	<code>method</code> → <code>GmlStruct</code>
		</li><li>	<code>instance</code> → <code>GmlStruct</code>
		</li></ul><p>
		Passing a converted reference type back to where it came from
		(e.g. passing a <code>LuaTable</code> back into the Lua state) will represent
		it with the original value.
		</p><p>
		Passing a Lua reference type from one state to another currently uses a
		special kind of <code>GmlStruct</code> as a proxy, so get/set/call operations will work,
		but other metafunctions won't.
	</p></article></section><section><header id="LuaRef"><a href="#LuaRef" title="(permalink)">Lua references in GML</a></header><article><p>
		Returning a Lua reference-based type (such as a table, function, or userdata) to GML
		will produce a <code>LuaRef</code> struct.
		</p><p>
		It has the following methods:
		</p><section><header id="LuaRef-toString"><a href="#LuaRef-toString" title="(permalink)">toString()&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Returns a short, unique string representation of the value.
			</p><p>
			It'll usually look like this:
			</p><pre>
LuaRef(state:000000000474BEF0, uid:100000)
</pre></article></section><section><header id="LuaRef-typename"><a href="#LuaRef-typename" title="(permalink)">typename()&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Returns what exactly this is, anyway.
			</p><p>
			Possible return values are: </p><ul>
				<li>	<code>"table"</code>
				</li><li>	<code>"function"</code>
				</li><li>	<code>"thread"</code>
				</li><li>	<code>"userdata"</code>
			</li></ul></article></section><hr/><p>
		The following can be used if the value is a table or a userdata that
		has a metatable with appropriate metamethods (see <a href="https://www.lua.org/manual/5.4/manual.html#2.4">§2.4</a>).
		</p><section><header id="LuaRef-length"><a href="#LuaRef-length" title="(permalink)">length()&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Returns the length of the table, as per <code>#table</code> operator in Lua.
		</p></article></section><section><header id="LuaRef-get"><a href="#LuaRef-get" title="(permalink)">get(key)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Retrieves an item from a table, as with <code>table[key]</code> in Lua.
		</p></article></section><section><header id="LuaRef-set"><a href="#LuaRef-set" title="(permalink)">set(key, value)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Stores/changes an item in a table, as with <code>table[key] = value</code> in Lua.
		</p></article></section><hr/><p>
		The following can be used if the value is a function or its metatable
		implements the <code>__call</code> metamethod (see <a href="https://www.lua.org/manual/5.4/manual.html#3.4.10">§3.4.10</a>).
		</p><section><header id="LuaRef-call"><a href="#LuaRef-call" title="(permalink)">call(...args)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Invokes the value (if it's a function or has a <code>__call</code> in its metatable)
			and returns the result.
		</p></article></section><section><header id="LuaRef-callMultRet"><a href="#LuaRef-callMultRet" title="(permalink)">callMultRet(...args)&#8203;<span class="ret-arrow">&#10140;</span>array</a></header><article><p>
			Like <code>call</code>, but returns an array of resulting values (see <a href="https://www.lua.org/manual/5.4/manual.html#3.3.4">§3.3.4</a>).
		</p></article></section><section><header id="callExt"><a href="#callExt" title="(permalink)">callExt(argArray, ?argCount)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Like <code>call</code>, but takes arguments as an array.
			</p><p>
			If <code>argCount</code> is not provided, it'll be set to length of <code>argArray</code>.
		</p></article></section><section><header id="callExtMultRet"><a href="#callExtMultRet" title="(permalink)">callExtMultRet(argArray, ?argCount)&#8203;<span class="ret-arrow">&#10140;</span>array</a></header><article><p>
			Combines the above two functions,
			taking arguments as an array and returning results as an array.
		</p></article></section></article></section><section><header id="GmlRef"><a href="#GmlRef" title="(permalink)">GML references in Lua</a></header><article><section><header id="GmlArray"><a href="#GmlArray" title="(permalink)">GmlArray</a></header><article><p>
			Implements <code>__len</code>, <code>__index</code>, and <code>__newindex</code> (see <a href="https://www.lua.org/manual/5.4/manual.html#2.4">§2.4</a>).
			</p><p>
			Pretends to be 1-indexed to save your end user some sanity.
		</p></article></section><section><header id="GmlStruct"><a href="#GmlStruct" title="(permalink)">GmlStruct</a></header><article><p>
			Implements <code>__index</code>, <code>__newindex</code>, and <code>__call</code> (see <a href="https://www.lua.org/manual/5.4/manual.html#2.4">§2.4</a>).
			</p><p>
			Methods also turn into <code>GmlStruct</code> (because they <i>are</i> structs),
			much like numerous other "structy" new data types.
		</p></article></section></article></section></article></section><section><header id="lua_raw"><a href="#lua_raw" title="(permalink)">Raw API</a></header><article><section><header id="lua_stack"><a href="#lua_stack" title="(permalink)">Stack manipulation</a></header><article><section><header id="lua_stack_size"><a href="#lua_stack_size" title="(permalink)">lua_stack_size(state)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Returns the number of elements on a state's stack.
			</p><p>
			<b>C function:</b> <a href="https://www.lua.org/manual/5.4/manual.html#lua_gettop"><code>lua_gettop</code></a>
		</p></article></section><section><header id="lua_stack_clear"><a href="#lua_stack_clear" title="(permalink)">lua_stack_clear(state)</a></header><article><p>
			Removes all elements from a state's stack.
			</p><p>
			<b>C function:</b> <a href="https://www.lua.org/manual/5.4/manual.html#lua_settop"><code>lua_settop</code></a>
		</p></article></section><section><header id="lua_stack_discard"><a href="#lua_stack_discard" title="(permalink)">lua_stack_discard(state, count)</a></header><article><p>
			Removes N elements from a state's stack.
			</p><p>
			<b>C function:</b> <a href="https://www.lua.org/manual/5.4/manual.html#lua_pop"><code>lua_pop</code></a>
		</p></article></section><section><header id="lua_stack_resize"><a href="#lua_stack_resize" title="(permalink)">lua_stack_resize(state, newSize)</a></header><article><p>
			Resizes a state's stack. This can discard existing values or push <code>nil</code>s to the stack.
			</p><p>
			<b>C function:</b> <a href="https://www.lua.org/manual/5.4/manual.html#lua_settop"><code>lua_settop</code></a>
		</p></article></section><section><header id="lua_stack_ensure"><a href="#lua_stack_ensure" title="(permalink)">lua_stack_ensure(state, count)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Ensures that a state's stack has space for at least N extra elements.
			</p><p>
			By default, Lua ensures that there's space for 20 extra items on the stack,
			so you'll want to call this before pushing a large/arbitrary number of elements
			(see <a href="https://www.lua.org/manual/5.4/manual.html#4.1.1">§4.1.1</a>).
			</p><p>
			<a href="#lua_stack_push">lua_stack_push</a>[_ext] calls this automatically, but other functions don't.
			</p><p>
			Returns whether the request can be fulfilled.
			</p><p>
			<b>C function:</b> <a href="https://www.lua.org/manual/5.4/manual.html#lua_checkstack"><code>lua_checkstack</code></a>
		</p></article></section><hr/><section><header id="lua_stack_get"><a href="#lua_stack_get" title="(permalink)">lua_stack_get(state, index)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Returns an element of a state's stack at a position.
			</p><p>
			Stack indexes are 1-based (first/bottom element is 1) but you can also use <i>negative</i>
			indexes to work with elements at the top of the stack (see <a href="https://www.lua.org/manual/5.4/manual.html#4.1">§4.1</a>).
		</p></article></section><hr/><section><header id="lua_stack_pop"><a href="#lua_stack_pop" title="(permalink)">lua_stack_pop(state)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Removes and returns a single value from a state's stack.
		</p></article></section><section><header id="lua_stack_pop_multret"><a href="#lua_stack_pop_multret" title="(permalink)">lua_stack_pop_multret(state, count = -1)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Removes and returns a number of values from a state's stack as an array.
			</p><p>
			Use <code>-1</code> to pop all stack elements.
		</p></article></section><hr/><section><header id="lua_stack_push"><a href="#lua_stack_push" title="(permalink)">lua_stack_push(state, ...values)</a></header><article><p>
			Pushes one or more values to a state's stack.
		</p></article></section><section><header id="lua_stack_push_ext"><a href="#lua_stack_push_ext" title="(permalink)">lua_stack_push_ext(state, valArray, offset = 0, count = -1)</a></header><article><p>
			Pushes one or more values from an array to a state's stack.
			</p><p>
			Negative values for <code>count</code> will push the remainder of an array (length-offset).
		</p></article></section><section><header id="lua_stack_push_global"><a href="#lua_stack_push_global" title="(permalink)">lua_stack_push_global(state, name)</a></header><article><p>
			Pushes a global variable of a state to its stack.
			</p><p>
			<b>C function:</b> <a href="https://www.lua.org/manual/5.4/manual.html#lua_getglobal"><code>lua_getglobal</code></a>
		</p></article></section><section><header id="lua_stack_push_new_table"><a href="#lua_stack_push_new_table" title="(permalink)">lua_stack_push_new_table(state)</a></header><article><p>
			Pushes a new, empty table to a state's stack.
			</p><p>
			<b>C function:</b> <a href="https://www.lua.org/manual/5.4/manual.html#lua_newtable"><code>lua_newtable</code></a>
		</p></article></section></article></section><section><header id="lua_raw_calls"><a href="#lua_raw_calls" title="(permalink)">Calls</a></header><article><section><header id="lua_raw_call"><a href="#lua_raw_call" title="(permalink)">lua_raw_call(state, numArgs)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Performs a call with N arguments.
			The function/value to call precedes the arguments on the stack.
			</p><p>
			For example, when you do <code>state.call("myfunc", 1, 2, 3)</code>, what Apollo does is
			</p><pre class="gmlmd">
<a class="sf" href="#lua_stack_push_global">lua_stack_push_global</a><span class="op">(</span><span class="uv">state</span><span class="op">)</span><span class="op">;</span>
<a class="sf" href="#lua_stack_push">lua_stack_push</a><span class="op">(</span><span class="uv">state</span><span class="op">,</span> <span class="nu">1</span><span class="op">,</span> <span class="nu">2</span><span class="op">,</span> <span class="nu">3</span><span class="op">)</span><span class="op">;</span>
<span class="kw">return</span> <a class="sf" href="#lua_raw_call">lua_raw_call</a><span class="op">(</span><span class="uv">state</span><span class="op">,</span> <span class="nu">3</span><span class="op">)</span><span class="op">;</span>
</pre><p>
			<b>C function:</b> <a href="https://www.lua.org/manual/5.4/manual.html#lua_pcall"><code>lua_pcall</code></a>
		</p></article></section><section><header id="lua_raw_call_multret"><a href="#lua_raw_call_multret" title="(permalink)">lua_raw_call_multret(state, numArgs)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Like <code>lua_raw_call</code>, but packs multiple returned values into an array (see <a href="https://www.lua.org/manual/5.4/manual.html#3.3.4">§3.3.4</a>).
		</p></article></section><section><header id="lua_raw_call_ext"><a href="#lua_raw_call_ext" title="(permalink)">lua_raw_call_ext(state, numArgs, numResults)&#8203;<span class="ret-arrow">&#10140;</span></a></header><article><p>
			Like <code>lua_raw_call</code>, but leaves returned value(s) on the stack.
			</p><p>
			If <code>numResults</code> is -1, leaves it up to the function -
			you can use <a href="#lua_stack_size">lua_stack_size</a> to find out how many values were returned
			(and you should remove all of them from the stack afterwards).
			</p><p>
			Otherwise makes sure that there are <code>numResults</code> values on the stack,
			either discarding the extra values or inserting <code>nil</code>s for the missing ones.
		</p></article></section></article></section></article></section><section><header id="TODOs"><a href="#TODOs" title="(permalink)">TODOs</a></header><article><ul>
	<li>	Loading from file<br/>
		Have to change working directory and then change it back,
		which works a little weird for some things.<br/>
		And then people reported that you can't <code>require()</code> a path with non-Latin glyphs in it,
		but this somehow works in a few other Lua integrations.
	</li><li>	Lua coroutines<br/>
		(did anyone actually use these?)
	</li><li>	Multi-returns from GML functions (<code>lua_return</code> in v2)<br/>
		For now you can just return an array and unpack it on Lua side.
	</li><li>	GitHub Actions for cross-platform builds<br/>
		However, GH Actions do not currently have an ARM Mac target.<br/>
		Would I have to buy a second, newer Mac Mini just to make ARM extension builds?
	</li></ul></article></section></p><!--doc>-->
</section></main></div>
<script type="text/javascript">(function() {
	var doc, headers;
	//
	var path = "Apollo cheat sheet";
	var state = null;
	if (window.localStorage && JSON.parse) {
		state = window.localStorage.getItem(path);
		state = state ? JSON.parse(state) : { };
		if (state == null) state = { };
	}
	var isLocal = (location.host.indexOf("localhost") == 0);
	//
	function h3bind(h3) {
		var node = h3.parentNode;
		var snip = node.children[1];
		var id = h3.id || h3.textContent;
		h3.snip = snip;
		h3.doc_set = function(z) {
			if (z) node.classList.add("open"); else node.classList.remove("open");
			if (state) {
				state[id] = z;
				window.localStorage.setItem(path, JSON.stringify(state));
			}
		}
		h3.doc_hide = function() {
			this.doc_set(false);
		}
		h3.doc_show = function() {
			this.doc_set(true);
		}
		h3.onclick = function(_) {
			var seen = !node.classList.contains("open");
			h3.doc_set(seen);
			return false;
		};
	}
	function getHashFunc(id) {
		var node = document.getElementById(id);
		if (node == null) return null;
		return function(e) {
			while (node && node != doc) {
				if (node.classList.contains("item")) {
					node.classList.add("open");
				}
				node = node.parentElement;
			}
		};
	}
	// Display helpers:
	window.opt_none = function() {
		for (var li = 0; li < headers.length; li++) headers[li].doc_hide();
	};
	window.opt_list = function() {
		for (var li = 0; li < headers.length; li++) {
			var h3 = headers[li];
			if (h3.parentNode.parentNode != doc) {
				h3.doc_hide();
			} else h3.doc_show();
		}
	};
	window.opt_all = function() {
		for (var li = 0; li < headers.length; li++) headers[li].doc_show();
	};
	window.live_post = function() {
		doc = document.getElementById("doc");
		headers = doc.getElementsByTagName("header");
		//
		for (var i = 0; i < headers.length; i++) h3bind(headers[i]);
		// Clicks in document expand the related section:
		var anchors = doc.getElementsByTagName("a");
		for (var i = 0; i < anchors.length; i++) {
			var anchor = anchors[i];
			if (anchor.classList.contains("header")) continue;
			var href = anchor.getAttribute("href");
			if (href[0] == "#") {
				var fn = getHashFunc(href.substr(1));
				if (!fn) {
					anchor.classList.add("broken");
					anchor.title = "(section missing)";
				} else anchor.addEventListener("click", fn);
			}
		}
		//
		for (var li = 0; li < headers.length; li++) {
			var h3 = headers[li];
			var val = state ? state[h3.id || h3.textContent] : null;
			if (val == null) val = isLocal || h3.parentNode.parentNode == doc;
			if (val) h3.doc_show(); else h3.doc_hide();
		}
	};
	window.live_post();
	//
	(function() {
		var hash = document.location.hash;
		if (hash) {
			var _hash = hash.substr(1);
			getHashFunc(_hash)();
			setTimeout(function() {
				document.location.hash = hash + " ";
				setTimeout(function() {
					document.location.hash = hash;
				}, 100);
			}, 100);
		}
	})();
	//
	doc.setAttribute("ready", "");
	})();</script>
</body></html>
